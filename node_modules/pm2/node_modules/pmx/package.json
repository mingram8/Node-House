{
  "name": "pmx",
  "version": "0.6.8",
  "description": "Programmatic interface for Keymetrics.io",
  "main": "index.js",
  "dependencies": {
    "debug": "^2.2",
    "json-stringify-safe": "^5.0"
  },
  "devDependencies": {
    "express": "*",
    "request": "*",
    "should": "*",
    "mocha": "*",
    "shelljs": "*"
  },
  "scripts": {
    "test": "DEBUG='axm:*' mocha test/*.mocha.js"
  },
  "keywords": [
    "cli",
    "fault tolerant",
    "sysadmin",
    "tools",
    "pm2",
    "logs",
    "log",
    "json",
    "express",
    "hapi",
    "kraken",
    "reload",
    "microservice",
    "programmatic",
    "harmony",
    "node-pm2",
    "production",
    "keymetrics",
    "node.js monitoring",
    "strong-pm",
    "deploy",
    "deployment",
    "daemon",
    "supervisor",
    "nodemon",
    "pm2.io",
    "ghost",
    "ghost production",
    "monitoring",
    "process manager",
    "forever",
    "profiling",
    "probes",
    "forever-monitor",
    "keep process alive",
    "process configuration",
    "clustering",
    "cluster cli",
    "cluster",
    "cron",
    "devops",
    "dev ops"
  ],
  "repository": {
    "type": "git",
    "url": "https://github.com/keymetrics/pmx.git"
  },
  "author": {
    "name": "Keymetrics I/O"
  },
  "license": "MIT",
  "readme": "# Keymetrics Driver\n\n![Keymetrics](https://keymetrics.io/assets/images/application-demo.png)\n[![bitHound Overalll Score](https://www.bithound.io/github/keymetrics/pmx/badges/score.svg)](https://www.bithound.io/github/keymetrics/pmx)\n![Build Status](https://api.travis-ci.org/keymetrics/pmx.png?branch=master)\n\nPMX is a module that allows you to create advanced interactions with Keymetrics.\n\nIt allows you to:\n\n- **Expose Functions** remotely triggerable from Keymetrics\n- **Expose Metrics** displayed in realtime and tracked over the time\n- **Report Alerts** like exceptions or critical issues\n- **Report Events** to inform about anything\n- **Monitor network traffic** at the application level and display used ports\n- Analyze HTTP latency\n\n# Installation\n\nInstall PMX and add it to your package.json with:\n\n```bash\n$ npm install pmx --save\n```\n\n```javascript\nvar pmx = require('pmx').init({\n  http          : true, // HTTP routes logging (default: false)\n  http_latency  : 200,  // Limit of acceptable latency\n  http_code     : 500,  // Error code to track'\n  alert_enabled : true,  // Enable alerts (If you add alert subfield in custom it's going to be enabled)\n  ignore_routes : [/socket\\.io/, /notFound/], // Ignore http routes with this pattern (default: [])\n  errors        : true, // Exceptions loggin (default: true)\n  custom_probes : true, // Auto expose JS Loop Latency and HTTP req/s as custom metrics (default: true)\n  network       : true, // Network monitoring at the application level (default: false)\n  ports         : true  // Shows which ports your app is listening on (default: false)\n});\n```\n\n## Expose Functions: Trigger Functions remotely\n\nRemotely trigger functions from Keymetrics. These metrics takes place in the main Keymetrics Dashboard page under the Custom Action section.\n\n### Simple actions\n\nSimple action allows to trigger a function from Keymetrics. The function takes a function as a parameter (reply here) and need to be called once the job is finished.\n\nExample:\n\n```javascript\nvar pmx = require('pmx');\n\npmx.action('db:clean', function(reply) {\n  clean.db(function() {\n    /**\n     * reply() must be called at the end of the action\n     */\n     reply({success : true});\n  });\n});\n```\n\n### Scoped actions\n\nScoped Actions are advanced remote actions that can be also triggered from Keymetrics.\n\nTwo arguments are passed to the function, data (optionnal data sent from Keymetrics) and res that allows to emit log data and to end the scoped action.\n\nExample:\n\n```javascript\npmx.scopedAction('long running lsof', function(data, res) {\n  var child = spawn('lsof', []);\n\n  child.stdout.on('data', function(chunk) {\n    chunk.toString().split('\\n').forEach(function(line) {\n      res.send(line); // This send log to Keymetrics to be saved (for tracking)\n    });\n  });\n\n  child.stdout.on('end', function(chunk) {\n    res.end('end'); // This end the scoped action\n  });\n\n  child.on('error', function(e) {\n    res.error(e);  // This report an error to Keymetrics\n  });\n\n});\n```\n\n## Expose Metrics: Measure anything\n\nKeymetrics allows you to expose any metrics from you code to the Keymetrics Dashboard, in realtime. These metrics takes place in the main Keymetrics Dashboard page under the Custom Metrics section.\n\n4 helpers are available:\n\n- **Simple metrics**: Values that can be read instantly\n    - eg. Monitor variable value\n- **Counter**: Things that increment or decrement\n    - eg. Downloads being processed, user connected\n- **Meter**: Things that are measured as events / interval\n    - eg. Request per minute for a http server\n- **Histogram**: Keeps a resevoir of statistically relevant values biased towards the last 5 minutes to explore their distribution\n    - eg. Monitor the mean of execution of a query into database\n\n### Metric: Simple value reporting\n\nThis allow to expose values that can be read instantly.\n\n```javascript\nvar probe = pmx.probe();\n\n// Here the value function will be called each second to get the value\nvar metric = probe.metric({\n  name    : 'Realtime user',\n  value   : function() {\n    return Object.keys(users).length;\n  }\n});\n\n// Here we are going to call valvar.set() to set the new value\nvar valvar = probe.metric({\n  name    : 'Realtime Value'\n});\n\nvalvar.set(23);\n```\n\n### Counter: Sequential value change\n\nThings that increment or decrement.\n\n```javascript\nvar probe = pmx.probe();\n\n// The counter will start at 0\nvar counter = probe.counter({\n  name : 'Current req processed'\n});\n\nhttp.createServer(function(req, res) {\n  // Increment the counter, counter will eq 1\n  counter.inc();\n  req.on('end', function() {\n    // Decrement the counter, counter will eq 0\n    counter.dec();\n  });\n});\n```\n\n### Meter: Average calculated values\n\nThings that are measured as events / interval.\n\n```javascript\nvar probe = pmx.probe();\n\nvar meter = probe.meter({\n  name      : 'req/min',\n  samples   : 1,\n  timeframe : 60\n});\n\nhttp.createServer(function(req, res) {\n  meter.mark();\n  res.end({success:true});\n});\n```\n\n#### Options\n\n**samples** option is the rate unit. Defaults to **1** sec.\n**timeframe** option is the timeframe over which events will be analyzed. Defaults to **60** sec.\n\n### Histogram\n\nKeeps a resevoir of statistically relevant values biased towards the last 5 minutes to explore their distribution.\n\n```javascript\nvar probe = pmx.probe();\n\nvar histogram = probe.histogram({\n  name        : 'latency',\n  measurement : 'mean'\n});\n\nvar latency = 0;\n\nsetInterval(function() {\n  latency = Math.round(Math.random() * 100);\n  histogram.update(latency);\n}, 100);\n```\n\n### Common Custom Metrics options\n\n- `name` : The probe name as is will be displayed on the **Keymetrics** dashboard\n- `agg_type` : This param is optionnal, it can be `sum`, `max`, `min`, `avg` (default) or `none`. It will impact the way the probe data are aggregated within the **Keymetrics** backend. Use `none` if this is irrelevant (eg: constant or string value).\n- `alert` : For `Meter` and `Counter` probes. This param is optionnal. Creates an alert object (see below).\n\n### Alert System for Custom Metrics\n\nThis alert system can monitor a Probe value and launch an exception when hitting a particular value.\n\nExample for a `cpu_usage` var:\n```javascript\nvar metric = probe.metric({\n  name  : 'CPU usage',\n  value : function() {\n    return cpu_usage;\n  },\n  alert : {\n    mode  : 'threshold',\n    value : 95,\n    msg   : 'Detected over 95% CPU usage', // optional\n    func  : function() { //optional\n      console.error('Detected over 95% CPU usage');\n    },\n    cmp   : \"<\" // optional\n  }\n});\n```\n\n####Options:\n\n- `mode` : `threshold`, `threshold-avg`.\n- `value` : Value that will be used for the exception check.\n- `msg` : String used for the exception.\n- `func` :  **optional**. Function declenched when exception reached.\n- `cmp` : **optional**. If current Probe value is not `<`, `>`, `=` to Threshold value the exception is launched. Can also be a function used for exception check taking 2 arguments and returning a bool.\n- `interval` : **optional**, `threshold-avg` mode. Sample length for monitored value (180 seconds default).\n- `timeout` : **optional**, `threshold-avg` mode. Time after which mean comparison starts (30 000 milliseconds default).\n\n## Report Alerts: Errors / Uncaught Exceptions\n\nBy default once PM2 is linked to Keymetrics, you will be alerted of any uncaught exception.\nThese errors are accessible in the **Issue** tab of Keymetrics.\n\n### Custom alert notification\n\nIf you need to alert about any critical errors you can do it programmatically:\n\n```javascript\nvar pmx = require('pmx');\n\npmx.notify({ success : false });\n\npmx.notify('This is an error');\n\npmx.notify(new Error('This is an error'));\n```\n\n### Add Verbosity to an Alert: Express Error handler\n\nWhen an uncaught exception is happening you can track from which routes it has been thrown.\nTo do that you have to attach the middleware `pmx.expressErrorHandler` at then end of your routes mounting:\n\n```javascript\nvar pmx = require('pmx');\n\n// All my routes\napp.get('/' ...);\napp.post(...);\n// All my routes\n\n// Here I attach the middleware to get more verbosity on exception thrown\napp.use(pmx.expressErrorHandler());\n```\n\n## Emit Events\n\nEmit events and get historical and statistics.\nThis is available in the **Events** page of Keymetrics.\n\n```javascript\nvar pmx = require('pmx');\n\npmx.emit('user:register', {\n  user : 'Alex registered',\n  email : 'thorustor@gmail.com'\n});\n```\n\n## Application level network traffic monitoring / Display used ports\n\nYou can monitor the network usage of a specific application by adding the option `network: true` when initializing PMX. If you enable the flag `ports: true` when you init pmx it will show which ports your app is listenting on.\n\nThese metrics will be shown in the Keymetrics Dashboard in the Custom Metrics section.\n\nExample:\n\n```\npmx.init({\n  [...]\n  network : true, // Allow application level network monitoring\n  ports   : true  // Display ports used by the application\n});\n```\n\n## HTTP latency analysis\n\nMonitor routes, latency and codes. REST compliant.\n\n```javascript\npmx.http(); // You must do this BEFORE any require('http')\n```\nIgnore some routes by passing a list of regular expressions.\n```javascript\npmx.http({\n  http          : true, // (Default: true)\n  ignore_routes : [/socket\\.io/, /notFound/] // Ignore http routes with this pattern (Default: [])\n});\n```\nThis can also be done via pmx.init()\n```javascript\npmx.init({\n  http          : true, // (Default: true)\n  ignore_routes : [/socket\\.io/, /notFound/] // Ignore http routes with this pattern (Default: [])\n});\n```\n\n## License\n\nMIT\n\n[![GA](https://ga-beacon.appspot.com/UA-51122580-2/pmx/readme?pixel&useReferer)](https://github.com/igrigorik/ga-beacon)\n",
  "readmeFilename": "README.md",
  "bugs": {
    "url": "https://github.com/keymetrics/pmx/issues"
  },
  "_id": "pmx@0.6.8",
  "dist": {
    "shasum": "06969daafdb118d09504224878933988bee3cb94"
  },
  "_from": "https://registry.npmjs.org/pmx/-/pmx-0.6.8.tgz",
  "_resolved": "https://registry.npmjs.org/pmx/-/pmx-0.6.8.tgz"
}
